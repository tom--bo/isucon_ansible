- hosts: isucon_server
  become: yes
  vars:
    isuconuser: isucon
  tasks:

    - include: ubuntu.yml
      when: ansible_distribution == "Ubuntu"

    - include: redhat.yml
      when: "ansible_os_family == 'RedHat'"

        #    - name: Add group isucon
        #      group: name={{isuconuser}}
        #
        #    - name: Add user isucon
        #      user: name={{ isuconuser }} shell=/bin/zsh group=sudo
        #      # user: name={{ isuconuser }} shell=/bin/zsh group=root # redhat


    - name: (temporary) copy dotfiles to isucon user
      copy: >
        src=submodules/dotfiles
        dest=/home/{{ isuconuser }}
        owner={{ isuconuser }}
        mode=0755

    - name: Set up isucon
      copy: >
        src=submodules/settings
        dest=/home/{{ isuconuser }}
        owner={{ isuconuser }}
        mode=0755


    - name: Change default shell to zsh
      user: name={{ isuconuser }} shell=/bin/zsh

    - name: (temporary) set zshrc file
      file: >
        src=/home/{{ isuconuser }}/dotfiles/zshrc
        dest=/home/{{ isuconuser }}/.zshrc
        owner={{ isuconuser }}
        state=link

    - name: (temporary) set vimrc file
      file: >
        src=/home/{{ isuconuser }}/dotfiles/vimrc
        dest=/home/{{ isuconuser }}/.vimrc
        owner={{ isuconuser }}
        state=link

    - name: (temporary) set tmux file
      file: >
        src=/home/{{ isuconuser }}/dotfiles/tmux.conf
        dest=/home/{{ isuconuser }}/.tmux.conf
        owner={{ isuconuser }}
        state=link



